<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="python," />





  <link rel="alternate" href="/atom.xml" title="whistlestop" type="application/atom+xml" />






<meta name="description" content="Reading and Writing CSV DataFor most kinds of CSV data, use the csv library. 1234567import csvwith open(&apos;stocks.csv&apos;) as f:     f_csv = csv.reader(f)     headers = next(f_csv)     for row in f_csv:">
<meta name="keywords" content="python">
<meta property="og:type" content="article">
<meta property="og:title" content="C06_Data_Encoding_and_Processing">
<meta property="og:url" content="blog.whistlestop.ml/2018/12/15/C06-Data-Encoding-and-Processing/index.html">
<meta property="og:site_name" content="whistlestop">
<meta property="og:description" content="Reading and Writing CSV DataFor most kinds of CSV data, use the csv library. 1234567import csvwith open(&apos;stocks.csv&apos;) as f:     f_csv = csv.reader(f)     headers = next(f_csv)     for row in f_csv:">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2018-12-15T11:11:50.237Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="C06_Data_Encoding_and_Processing">
<meta name="twitter:description" content="Reading and Writing CSV DataFor most kinds of CSV data, use the csv library. 1234567import csvwith open(&apos;stocks.csv&apos;) as f:     f_csv = csv.reader(f)     headers = next(f_csv)     for row in f_csv:">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="blog.whistlestop.ml/2018/12/15/C06-Data-Encoding-and-Processing/"/>





  <title>C06_Data_Encoding_and_Processing | whistlestop</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  

  <div class="container  page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">whistlestop</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Never start something you're not willing to finish.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            Sitemap
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="blog.whistlestop.ml/2018/12/15/C06-Data-Encoding-and-Processing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="eustoma">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="whistlestop">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">C06_Data_Encoding_and_Processing</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-12-15T18:44:23+08:00">
                2018-12-15
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2018-12-15T19:11:50+08:00">
                2018-12-15
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/book-notes/" itemprop="url" rel="index">
                    <span itemprop="name">book notes</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="Reading-and-Writing-CSV-Data"><a href="#Reading-and-Writing-CSV-Data" class="headerlink" title="Reading and Writing CSV Data"></a>Reading and Writing CSV Data</h2><p>For most kinds of CSV data, use the <strong>csv</strong> library.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'stocks.csv'</span>) <span class="keyword">as</span> f:</span><br><span class="line">     f_csv = csv.reader(f)</span><br><span class="line">     headers = next(f_csv)</span><br><span class="line">     <span class="keyword">for</span> row <span class="keyword">in</span> f_csv:</span><br><span class="line">        <span class="comment"># Process row</span></span><br><span class="line">        ...</span><br></pre></td></tr></table></figure>
<a id="more"></a> 
<p>In the preceding code, row will be a <strong>tuple</strong>. Thus, to access certain fields, you will need to use indexing, such as <strong>row[0]</strong> (Symbol) and <strong>row[4]</strong> (Change).</p>
<p>Since such indexing can often be confusing, this is one place where you might want to consider the use of <strong>named tuples</strong>. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'stock.csv'</span>) <span class="keyword">as</span> f:</span><br><span class="line">     f_csv = csv.reader(f)</span><br><span class="line">     headings = next(f_csv)</span><br><span class="line">     Row = namedtuple(<span class="string">'Row'</span>, headings)</span><br><span class="line">     <span class="keyword">for</span> r <span class="keyword">in</span> f_csv:</span><br><span class="line">     row = Row(*r)</span><br><span class="line">           <span class="comment">#Process row</span></span><br><span class="line">           ...</span><br></pre></td></tr></table></figure>
<p>This would allow you to use the column headers such as <strong>row.Symbol</strong> and <strong>row.Change</strong> instead of indices. It should be noted that this only works if the column headers are valid Python identifiers.</p>
<p>Another alternative is to read the data as a sequence of dictionaries instead.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'stocks.csv'</span>) <span class="keyword">as</span> f:</span><br><span class="line">      f_csv = csv.DictReader(f)</span><br><span class="line">      <span class="keyword">for</span> row <span class="keyword">in</span> f_csv:</span><br><span class="line">      <span class="comment"># process row</span></span><br><span class="line">           ...</span><br></pre></td></tr></table></figure></p>
<p>In this version, you would access the elements of each row using the row headers. For example, <strong>row[‘Symbol’]</strong> or <strong>row[‘Change’]</strong>.</p>
<p>To write CSV data, you also use the <strong>csv</strong> module but create a writer object. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>headers = [<span class="string">'Symbol'</span>, <span class="string">'Price'</span>, <span class="string">'Date'</span>, <span class="string">'Time'</span>, <span class="string">'Change'</span>, <span class="string">'Volume'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rows = [&#123;<span class="string">'Symbol'</span>:<span class="string">'AA'</span>, <span class="string">'Price'</span>:<span class="number">39.48</span>, <span class="string">'Date'</span>:<span class="string">'6/11/2007'</span>,</span><br><span class="line"><span class="meta">... </span> <span class="string">'Time'</span>:<span class="string">'9:36am'</span>, <span class="string">'Change'</span>:<span class="number">-0.18</span>, <span class="string">'Volume'</span>:<span class="number">181800</span>&#125;,</span><br><span class="line"><span class="meta">... </span> &#123;<span class="string">'Symbol'</span>:<span class="string">'AIG'</span>, <span class="string">'Price'</span>: <span class="number">71.38</span>, <span class="string">'Date'</span>:<span class="string">'6/11/2007'</span>,</span><br><span class="line"><span class="meta">... </span> <span class="string">'Time'</span>:<span class="string">'9:36am'</span>, <span class="string">'Change'</span>:<span class="number">-0.15</span>, <span class="string">'Volume'</span>: <span class="number">195500</span>&#125;,</span><br><span class="line"><span class="meta">... </span> &#123;<span class="string">'Symbol'</span>:<span class="string">'AXP'</span>, <span class="string">'Price'</span>: <span class="number">62.58</span>, <span class="string">'Date'</span>:<span class="string">'6/11/2007'</span>,</span><br><span class="line"><span class="meta">... </span> <span class="string">'Time'</span>:<span class="string">'9:36am'</span>, <span class="string">'Change'</span>:<span class="number">-0.46</span>, <span class="string">'Volume'</span>: <span class="number">935000</span>&#125;,</span><br><span class="line"><span class="meta">... </span> ]</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> open(<span class="string">'stocks.csv'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> f:</span><br><span class="line"><span class="meta">... </span>    f_csv= csv.DictWriter(f, headers)</span><br><span class="line"><span class="meta">... </span>    f_csv.writeheader()</span><br><span class="line"><span class="meta">... </span>    f_csv.writerows(rows)</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p> Here is one example of performing extra type conversions on CSV data:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>field_types = [ (<span class="string">'Price'</span>, float),</span><br><span class="line"><span class="meta">... </span> (<span class="string">'Change'</span>, float),</span><br><span class="line"><span class="meta">... </span> (<span class="string">'Volume'</span>, int) ]</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> open(<span class="string">'stock.csv'</span>) <span class="keyword">as</span> f:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">for</span> row <span class="keyword">in</span> csv.DictReader(f):</span><br><span class="line"><span class="meta">... </span>        row.update((key, conversion(row[key])) <span class="keyword">for</span> key, conversion <span class="keyword">in</span> field_types)</span><br><span class="line"><span class="meta">... </span>        print(row)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line">&#123;<span class="string">'Price'</span>: <span class="number">39.48</span>, <span class="string">'Change'</span>: <span class="number">-0.18</span>, <span class="string">'Time'</span>: <span class="string">'9:36am'</span>, <span class="string">'Volume'</span>: <span class="number">181800</span>, <span class="string">'Symbol'</span>: <span class="string">'AA'</span>, <span class="string">'Date'</span>: <span class="string">'6/11/2007'</span>&#125;</span><br><span class="line">&#123;<span class="string">'Price'</span>: <span class="number">71.38</span>, <span class="string">'Change'</span>: <span class="number">-0.15</span>, <span class="string">'Time'</span>: <span class="string">'9:36am'</span>, <span class="string">'Volume'</span>: <span class="number">195500</span>, <span class="string">'Symbol'</span>: <span class="string">'AIG'</span>, <span class="string">'Date'</span>: <span class="string">'6/11/2007'</span>&#125;</span><br><span class="line">&#123;<span class="string">'Price'</span>: <span class="number">62.58</span>, <span class="string">'Change'</span>: <span class="number">-0.46</span>, <span class="string">'Time'</span>: <span class="string">'9:36am'</span>, <span class="string">'Volume'</span>: <span class="number">935000</span>, <span class="string">'Symbol'</span>: <span class="string">'AXP'</span>, <span class="string">'Date'</span>: <span class="string">'6/11/2007'</span>&#125;</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line"><span class="comment">## Reading and Writing JSON Data</span></span><br><span class="line"></span><br><span class="line">JSON encoding supports the basic types of **<span class="keyword">None</span>**, **bool**, **int**, **float**, <span class="keyword">and</span> **str**, <span class="keyword">as</span> well <span class="keyword">as</span> **lists**, **tuples**, <span class="keyword">and</span> **dictionaries** containing those types. </span><br><span class="line"></span><br><span class="line">The format of JSON encoding <span class="keyword">is</span> almost identical to Python syntax <span class="keyword">except</span> <span class="keyword">for</span> a few minor changes. For instance, **<span class="keyword">True</span>** <span class="keyword">is</span> mapped to **true**, **<span class="keyword">False</span>** <span class="keyword">is</span> mapped to **false**, <span class="keyword">and</span> **<span class="keyword">None</span>** <span class="keyword">is</span> mapped to **null**.</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = &#123;<span class="string">'a'</span>: <span class="keyword">True</span>,</span><br><span class="line"><span class="meta">... </span><span class="string">'b'</span>: <span class="string">'Hello'</span>,</span><br><span class="line"><span class="meta">... </span><span class="string">'c'</span>: <span class="keyword">None</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>json.dumps(d)</span><br><span class="line"><span class="string">'&#123;"b": "Hello", "c": null, "a": true&#125;'</span></span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>Normally, JSON decoding will create <strong>dicts</strong> or <strong>lists</strong> from the supplied data. If you want to create different kinds of objects, supply the <strong>object_pairs_hook</strong> or <strong>object_hook</strong> to <strong>json.loads()</strong>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'&#123;"name": "ACME", "shares": 50, "price": 490.1&#125;'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>data = json.loads(s, object_pairs_hook=OrderedDict)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>data</span><br><span class="line">OrderedDict([(<span class="string">'name'</span>, <span class="string">'ACME'</span>), (<span class="string">'shares'</span>, <span class="number">50</span>), (<span class="string">'price'</span>, <span class="number">490.1</span>)])</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>Turn a JSON dictionary into a Python object</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">JSONObject</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, d)</span>:</span></span><br><span class="line"><span class="meta">... </span>        self.__dict__=d</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>data= json.loads(s, object_hook= JSONObject)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>data.name</span><br><span class="line"><span class="string">'ACME'</span></span><br></pre></td></tr></table></figure>
<p>The dictionary created by decoding the JSON data is passed as a single argument to <strong>__init__()</strong>. From there, you are free to use it as you will, such as using it directly as the instance dictionary of the object.</p>
<p> If you would like the output to be nicely formatted, you can use the indent argument to <strong>json.dumps()</strong>. This causes the output to be pretty printed in a format similar to that with the <strong>pprint()</strong> function. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(json.dumps(data, indent=<span class="number">4</span>))</span><br><span class="line">&#123;</span><br><span class="line"> <span class="string">"price"</span>: <span class="number">542.23</span>,</span><br><span class="line"> <span class="string">"name"</span>: <span class="string">"ACME"</span>,</span><br><span class="line"> <span class="string">"shares"</span>: <span class="number">100</span></span><br><span class="line">&#125;</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>If you want the keys to be sorted on output, used the <strong>sort_keys</strong> argument:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(json.dumps(data, sort_keys=<span class="keyword">True</span>))</span><br><span class="line">&#123;<span class="string">"name"</span>: <span class="string">"ACME"</span>, <span class="string">"price"</span>: <span class="number">542.23</span>, <span class="string">"shares"</span>: <span class="number">100</span>&#125;</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>Instances are not normally serializable as JSON. For example:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Point</span>:</span></span><br><span class="line"><span class="meta">... </span><span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, x, y)</span>:</span></span><br><span class="line"><span class="meta">... </span>self.x = x</span><br><span class="line"><span class="meta">... </span>self.y = y</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p = Point(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>json.dumps(p)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line"> File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line"> File <span class="string">"/usr/local/lib/python3.3/json/__init__.py"</span>, line <span class="number">226</span>, <span class="keyword">in</span> dumps</span><br><span class="line"> <span class="keyword">return</span> _default_encoder.encode(obj)</span><br><span class="line"> File <span class="string">"/usr/local/lib/python3.3/json/encoder.py"</span>, line <span class="number">187</span>, <span class="keyword">in</span> encode</span><br><span class="line"> chunks = self.iterencode(o, _one_shot=<span class="keyword">True</span>)</span><br><span class="line"> File <span class="string">"/usr/local/lib/python3.3/json/encoder.py"</span>, line <span class="number">245</span>, <span class="keyword">in</span> iterencode</span><br><span class="line"> <span class="keyword">return</span> _iterencode(o, <span class="number">0</span>)</span><br><span class="line"> File <span class="string">"/usr/local/lib/python3.3/json/encoder.py"</span>, line <span class="number">169</span>, <span class="keyword">in</span> default</span><br><span class="line"> <span class="keyword">raise</span> TypeError(repr(o) + <span class="string">" is not JSON serializable"</span>)</span><br><span class="line">TypeError: &lt;__main__.Point object at <span class="number">0x1006f2650</span>&gt; <span class="keyword">is</span> <span class="keyword">not</span> JSON serializable</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>If you want to serialize instances, you can supply a function that takes an instance as input and returns a dictionary that can be serialized. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">serialize_instance</span><span class="params">(obj)</span>:</span></span><br><span class="line"><span class="meta">... </span>    d=&#123;<span class="string">'__classname__'</span>: type(obj).__name__&#125;</span><br><span class="line"><span class="meta">... </span>    d.update(vars(obj))</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> d</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>If you want to get an instance back, you could write code like this:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>classes=&#123;<span class="string">'Point'</span>: Point&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">unserialize_object</span><span class="params">(d)</span>:</span></span><br><span class="line"><span class="meta">... </span>    clsname= d.pop(<span class="string">'__classname__'</span>, <span class="keyword">None</span>)</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">if</span> clsname:</span><br><span class="line"><span class="meta">... </span>        cls= classes[clsname]</span><br><span class="line"><span class="meta">... </span>        obj= cls.__new__(cls)</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">for</span> key, value <span class="keyword">in</span> d.items():</span><br><span class="line"><span class="meta">... </span>            setattr(obj, key, value)</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">return</span> obj</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">else</span>:</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">return</span> d</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p= Point(<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s= json.dumps(p, default=serialize_instance)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'&#123;"__classname__": "Point", "x": 2, "y": 3&#125;'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a= json.loads(s, object_hook= unserialize_object)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a</span><br><span class="line">&lt;__main__.Point object at <span class="number">0x00D00D10</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.x</span><br><span class="line"><span class="number">2</span></span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<h2 id="Parsing-Simple-XML-Data"><a href="#Parsing-Simple-XML-Data" class="headerlink" title="Parsing Simple XML Data"></a>Parsing Simple XML Data</h2><p>The <strong>xml.etree.ElementTree</strong> module can be used to extract data from simple XML documents. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen</span><br><span class="line"><span class="keyword">from</span> xml.etree.ElementTree <span class="keyword">import</span> parse</span><br><span class="line"><span class="comment"># Download the RSS feed and parse it</span></span><br><span class="line">u = urlopen(<span class="string">'http://planet.python.org/rss20.xml'</span>)</span><br><span class="line">doc = parse(u)</span><br><span class="line"><span class="comment"># Extract and output tags of interest</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> doc.iterfind(<span class="string">'channel/item'</span>):</span><br><span class="line">    title = item.findtext(<span class="string">'title'</span>)</span><br><span class="line">     date = item.findtext(<span class="string">'pubDate'</span>)</span><br><span class="line">     link = item.findtext(<span class="string">'link'</span>)</span><br><span class="line">     print(title)</span><br><span class="line">     print(date)</span><br><span class="line">     print(link)</span><br><span class="line">     print()</span><br><span class="line">Steve Holden: Python <span class="keyword">for</span> Data Analysis</span><br><span class="line">Mon, <span class="number">19</span> Nov <span class="number">2012</span> <span class="number">02</span>:<span class="number">13</span>:<span class="number">51</span> +<span class="number">0000</span></span><br><span class="line">http://holdenweb.blogspot.com/<span class="number">2012</span>/<span class="number">11</span>/python-<span class="keyword">for</span>-data-analysis.html</span><br><span class="line"></span><br><span class="line">Vasudev Ram: The Python Data model (<span class="keyword">for</span> v2 <span class="keyword">and</span> v3)</span><br><span class="line">Sun, <span class="number">18</span> Nov <span class="number">2012</span> <span class="number">22</span>:<span class="number">06</span>:<span class="number">47</span> +<span class="number">0000</span></span><br><span class="line">http://jugad2.blogspot.com/<span class="number">2012</span>/<span class="number">11</span>/the-python-data-model.html</span><br></pre></td></tr></table></figure>
<p>The <strong>xml.etree.ElementTree.parse()</strong> function parses the entire XML document into a document object. From there, you use methods such as <strong>find()</strong>, <strong>iterfind()</strong>, and <strong>findtext()</strong> to search for specific XML elements. The arguments to these functions are the names of a specific tag, such as <strong>channel/item</strong> or <strong>title</strong>.</p>
<p>Each element represented by the <strong>ElementTree</strong> module has a few essential attributes and methods that are useful when parsing. The <strong>tag</strong> attribute contains the name of the tag, the <strong>text</strong> attribute contains enclosed text, and the <strong>get()</strong> method can be used to extract attributes (if any).</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>e=doc.find(<span class="string">'channel/title'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>e</span><br><span class="line">&lt;Element <span class="string">'title'</span> at <span class="number">0x0101F540</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>e.tag</span><br><span class="line"><span class="string">'title'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>e.text</span><br><span class="line"><span class="string">'Planet Python'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>e.get(<span class="string">'some_attribute'</span>)</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<h2 id="Parsing-Huge-XML-Files-Incrementally"><a href="#Parsing-Huge-XML-Files-Incrementally" class="headerlink" title="Parsing Huge XML Files Incrementally"></a>Parsing Huge XML Files Incrementally</h2><p>You need to extract data from a huge XML document using as little memory as possible,  which are encoded like this:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># potholes.xml</span><br><span class="line"> <span class="tag">&lt;<span class="name">response</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">row</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">row</span> <span class="attr">...</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">creation_date</span>&gt;</span>2012-11-18T00:00:00<span class="tag">&lt;/<span class="name">creation_date</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">status</span>&gt;</span>Completed<span class="tag">&lt;/<span class="name">status</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">completion_date</span>&gt;</span>2012-11-18T00:00:00<span class="tag">&lt;/<span class="name">completion_date</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">service_request_number</span>&gt;</span>12-01906549<span class="tag">&lt;/<span class="name">service_request_number</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">type_of_service_request</span>&gt;</span>Pot Hole in Street<span class="tag">&lt;/<span class="name">type_of_service_request</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">current_activity</span>&gt;</span>Final Outcome<span class="tag">&lt;/<span class="name">current_activity</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">most_recent_action</span>&gt;</span>CDOT Street Cut ... Outcome<span class="tag">&lt;/<span class="name">most_recent_action</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">street_address</span>&gt;</span>4714 S TALMAN AVE<span class="tag">&lt;/<span class="name">street_address</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">zip</span>&gt;</span>60632<span class="tag">&lt;/<span class="name">zip</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">x_coordinate</span>&gt;</span>1159494.68618856<span class="tag">&lt;/<span class="name">x_coordinate</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">y_coordinate</span>&gt;</span>1873313.83503384<span class="tag">&lt;/<span class="name">y_coordinate</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">ward</span>&gt;</span>14<span class="tag">&lt;/<span class="name">ward</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">police_district</span>&gt;</span>9<span class="tag">&lt;/<span class="name">police_district</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">community_area</span>&gt;</span>58<span class="tag">&lt;/<span class="name">community_area</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">latitude</span>&gt;</span>41.808090232127896<span class="tag">&lt;/<span class="name">latitude</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">longitude</span>&gt;</span>-87.69053684711305<span class="tag">&lt;/<span class="name">longitude</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">location</span> <span class="attr">latitude</span>=<span class="string">"41.808090232127896"</span></span></span><br><span class="line"><span class="tag"> <span class="attr">longitude</span>=<span class="string">"-87.69053684711305"</span> /&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">row</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">row</span> <span class="attr">...</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Suppose you want to write a script that ranks ZIP codes by the number of pothole reports. To do it, you could write code like this:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> xml.etree.ElementTree <span class="keyword">import</span> parse</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line">potholes_by_zip = Counter()</span><br><span class="line">doc = parse(<span class="string">'potholes.xml'</span>)</span><br><span class="line"><span class="keyword">for</span> pothole <span class="keyword">in</span> doc.iterfind(<span class="string">'row/row'</span>):</span><br><span class="line">     potholes_by_zip[pothole.findtext(<span class="string">'zip'</span>)] += <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> zipcode, num <span class="keyword">in</span> potholes_by_zip.most_common():</span><br><span class="line">    print(zipcode, num)</span><br></pre></td></tr></table></figure>
<p>The only problem with this script is that it reads and parses the entire XML file into memory. </p>
<p>Here is a simple function that can be used to incrementally process huge XML files using a very small memory footprint:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> xml.etree.ElementTree <span class="keyword">import</span> iterparse</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">parse_and_remove</span><span class="params">(filename, path)</span>:</span></span><br><span class="line"><span class="meta">... </span>    path_parts= path.split(<span class="string">'/'</span>)</span><br><span class="line"><span class="meta">... </span>    doc= iterparse(filename,(<span class="string">'start'</span>, <span class="string">'end'</span>))</span><br><span class="line"><span class="meta">... </span>    next(doc)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">... </span>    tag_stack=[]</span><br><span class="line"><span class="meta">... </span>    elem_stack=[]</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">for</span> event, elem <span class="keyword">in</span> doc:</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">if</span> event==<span class="string">'start'</span>:</span><br><span class="line"><span class="meta">... </span>            tag_stack.append(elem.tag)</span><br><span class="line"><span class="meta">... </span>            elem_stack.append(elem)</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">elif</span> event==<span class="string">'end'</span>:</span><br><span class="line"><span class="meta">... </span>            <span class="keyword">if</span> tag_stack== path_parts:</span><br><span class="line"><span class="meta">... </span>                <span class="keyword">yield</span> elem</span><br><span class="line"><span class="meta">... </span>                elem_stack[<span class="number">-2</span>].remove(elem)</span><br><span class="line"><span class="meta">... </span>            <span class="keyword">try</span>:</span><br><span class="line"><span class="meta">... </span>                tag_stack.pop()</span><br><span class="line"><span class="meta">... </span>                elem_stack.pop()</span><br><span class="line"><span class="meta">... </span>            <span class="keyword">except</span> IndexError:</span><br><span class="line"><span class="meta">... </span>                <span class="keyword">pass</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>First, the <strong>iterparse()</strong> method allows incremental processing of XML documents. To use it, you supply the filename along with an event list consisting of one or more of the following: <strong>start</strong>, <strong>end</strong>, <strong>start-ns</strong>, and <strong>end-ns</strong>. The iterator created by <strong>iterparse()</strong> produces tuples of the form <strong>(event, elem)</strong>, where <strong>event</strong> is one of the listed <strong>events</strong> and <strong>elem</strong> is the resulting XML element. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>data = iterparse(<span class="string">'potholes.xml'</span>,(<span class="string">'start'</span>,<span class="string">'end'</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(data)</span><br><span class="line">(<span class="string">'start'</span>, &lt;Element <span class="string">'response'</span> at <span class="number">0x100771d60</span>&gt;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(data)</span><br><span class="line">(<span class="string">'start'</span>, &lt;Element <span class="string">'row'</span> at <span class="number">0x100771e68</span>&gt;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(data)</span><br><span class="line">(<span class="string">'start'</span>, &lt;Element <span class="string">'row'</span> at <span class="number">0x100771fc8</span>&gt;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(data)</span><br><span class="line">(<span class="string">'start'</span>, &lt;Element <span class="string">'creation_date'</span> at <span class="number">0x100771f18</span>&gt;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(data)</span><br><span class="line">(<span class="string">'end'</span>, &lt;Element <span class="string">'creation_date'</span> at <span class="number">0x100771f18</span>&gt;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(data)</span><br><span class="line">(<span class="string">'start'</span>, &lt;Element <span class="string">'status'</span> at <span class="number">0x1006a7f18</span>&gt;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(data)</span><br><span class="line">(<span class="string">'end'</span>, &lt;Element <span class="string">'status'</span> at <span class="number">0x1006a7f18</span>&gt;)</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>The <strong>start</strong> and <strong>end</strong> events are used to manage stacks of elements and tags. The stacks represent the current hierarchical structure of the document as it’s being parsed, and are also used to determine if an element matches the requested path given to the <strong>parse_and_remove()</strong> function. If a match is made, <strong>yield</strong> is used to emit it back to the caller.</p>
<p>The following statement after the <strong>yield</strong> is the core feature of ElementTree that makes this recipe save memory:</p>
<p><code>elem_stack[-2].remove(elem)</code></p>
<h2 id="Turning-a-Dictionary-into-XML"><a href="#Turning-a-Dictionary-into-XML" class="headerlink" title="Turning a Dictionary into XML"></a>Turning a Dictionary into XML</h2><p>You want to take the data in a Python dictionary and turn it into XML. Although the <strong>xml.etree.ElementTree</strong> library is commonly used for parsing, it can also be used to create XML documents.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> xml.etree.cElementTree <span class="keyword">import</span> Element</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">dict_to_xml</span><span class="params">(tag, d)</span>:</span></span><br><span class="line"><span class="meta">... </span>    elem= Element(tag)</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">for</span> key, val <span class="keyword">in</span> d.items():</span><br><span class="line"><span class="meta">... </span>        child= Element(key)</span><br><span class="line"><span class="meta">... </span>        child.text= str(val)</span><br><span class="line"><span class="meta">... </span>        elem.append(child)</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> elem</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = &#123; <span class="string">'name'</span>: <span class="string">'GOOG'</span>, <span class="string">'shares'</span>: <span class="number">100</span>, <span class="string">'price'</span>:<span class="number">490.1</span> &#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>e=dict_to_xml(<span class="string">'stock'</span>, s)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>e</span><br><span class="line">&lt;Element <span class="string">'stock'</span> at <span class="number">0x03B07E40</span>&gt;</span><br></pre></td></tr></table></figure>
<p>The result of this conversion is an Element instance. For I/O, it is easy to convert this to a byte string using the <strong>tostring()</strong> function in <strong>xml.etree.ElementTree</strong>. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> xml.etree.ElementTree <span class="keyword">import</span> tostring</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tostring(e)</span><br><span class="line"><span class="string">b'&lt;stock&gt;&lt;name&gt;GOOG&lt;/name&gt;&lt;shares&gt;100&lt;/shares&gt;&lt;price&gt;490.1&lt;/price&gt;&lt;/stock&gt;'</span></span><br></pre></td></tr></table></figure>
<p>If you want to attach attributes to an element, use its <strong>set()</strong> method.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>e.set(<span class="string">'_id'</span>, <span class="string">'1234'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tostring(e)</span><br><span class="line"><span class="string">b'&lt;stock _id="1234"&gt;&lt;name&gt;GOOG&lt;/name&gt;&lt;shares&gt;100&lt;/shares&gt;&lt;price&gt;490.1&lt;/price&gt;&lt;/stock&gt;'</span></span><br></pre></td></tr></table></figure>
<p>If the order of the elements matters, consider making an OrderedDict instead of a normal dictionary.</p>
<h2 id="Parsing-Modifying-and-Rewriting-XML"><a href="#Parsing-Modifying-and-Rewriting-XML" class="headerlink" title="Parsing, Modifying, and Rewriting XML"></a>Parsing, Modifying, and Rewriting XML</h2><p>You want to read an XML document, make changes to it, and then write it back out as XML. The <strong>xml.etree.ElementTree</strong> module makes it easy to perform such tasks. Essentially, you start out by parsing the document in the usual way. </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">stop</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">id</span>&gt;</span>14791<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">nm</span>&gt;</span>Clark &amp;amp; Balmoral<span class="tag">&lt;/<span class="name">nm</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">sri</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">rt</span>&gt;</span>22<span class="tag">&lt;/<span class="name">rt</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">d</span>&gt;</span>North Bound<span class="tag">&lt;/<span class="name">d</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">dd</span>&gt;</span>North Bound<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">sri</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">cr</span>&gt;</span>22<span class="tag">&lt;/<span class="name">cr</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">pre</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">pt</span>&gt;</span>5 MIN<span class="tag">&lt;/<span class="name">pt</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">fd</span>&gt;</span>Howard<span class="tag">&lt;/<span class="name">fd</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">v</span>&gt;</span>1378<span class="tag">&lt;/<span class="name">v</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">rn</span>&gt;</span>22<span class="tag">&lt;/<span class="name">rn</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">pre</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">pt</span>&gt;</span>15 MIN<span class="tag">&lt;/<span class="name">pt</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">fd</span>&gt;</span>Howard<span class="tag">&lt;/<span class="name">fd</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">v</span>&gt;</span>1867<span class="tag">&lt;/<span class="name">v</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">rn</span>&gt;</span>22<span class="tag">&lt;/<span class="name">rn</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">stop</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Here is an example of using <strong>ElementTree</strong> to read it and make changes to the structure:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> xml.etree.ElementTree <span class="keyword">import</span> parse, Element</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>doc= parse(<span class="string">'pred.xml'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>root= doc.getroot()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>root</span><br><span class="line">&lt;Element <span class="string">'stop'</span> at <span class="number">0x054DEE10</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>root.remove(root.find(<span class="string">'sri'</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>root.remove(root.find(<span class="string">'cr'</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>root.getchildren().index(root.find(<span class="string">'nm'</span>))</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>e= Element(<span class="string">'spam'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>e.text=<span class="string">'This is a test'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>root.insert(<span class="number">2</span>, e)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>doc.write(<span class="string">'newpred.xml'</span>, xml_declaration= <span class="keyword">True</span>)</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>The result of these operations is a new XML file that looks like this:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;?xml version='1.0' encoding='us-ascii'?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">stop</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">id</span>&gt;</span>14791<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">nm</span>&gt;</span>Clark &amp;amp; Balmoral<span class="tag">&lt;/<span class="name">nm</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">spam</span>&gt;</span>This is a test<span class="tag">&lt;/<span class="name">spam</span>&gt;</span><span class="tag">&lt;<span class="name">pre</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">pt</span>&gt;</span>5 MIN<span class="tag">&lt;/<span class="name">pt</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">fd</span>&gt;</span>Howard<span class="tag">&lt;/<span class="name">fd</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">v</span>&gt;</span>1378<span class="tag">&lt;/<span class="name">v</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">rn</span>&gt;</span>22<span class="tag">&lt;/<span class="name">rn</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">pre</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">pt</span>&gt;</span>15 MIN<span class="tag">&lt;/<span class="name">pt</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">fd</span>&gt;</span>Howard<span class="tag">&lt;/<span class="name">fd</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">v</span>&gt;</span>1867<span class="tag">&lt;/<span class="name">v</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">rn</span>&gt;</span>22<span class="tag">&lt;/<span class="name">rn</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">stop</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Parsing-XML-Documents-with-Namespaces"><a href="#Parsing-XML-Documents-with-Namespaces" class="headerlink" title="Parsing XML Documents with Namespaces"></a>Parsing XML Documents with Namespaces</h2><p>Consider a document that uses namespaces like this:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">top</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">author</span>&gt;</span>David Beazley<span class="tag">&lt;/<span class="name">author</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">content</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/1999/xhtml"</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">title</span>&gt;</span>Hello World<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello World!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">content</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">top</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>If you parse this document and try to perform the usual queries, you’ll find that it doesn’t work so easily because everything becomes incredibly verbose:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Some queries that work</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>doc.findtext(<span class="string">'author'</span>)</span><br><span class="line"><span class="string">'David Beazley'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># A query involving a namespace (doesn't work)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>doc.find(<span class="string">'content/html'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Works if fully qualified</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>doc.find(<span class="string">'content/&#123;http://www.w3.org/1999/xhtml&#125;html'</span>)</span><br><span class="line">&lt;Element <span class="string">'&#123;http://www.w3.org/1999/xhtml&#125;html'</span> at <span class="number">0x1007767e0</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Doesn't work</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>doc.findtext(<span class="string">'content/&#123;http://www.w3.org/1999/xhtml&#125;html/head/title'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Fully qualified</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>doc.findtext(<span class="string">'content/&#123;http://www.w3.org/1999/xhtml&#125;html/'</span></span><br><span class="line"><span class="meta">... </span><span class="string">'&#123;http://www.w3.org/1999/xhtml&#125;head/&#123;http://www.w3.org/1999/xhtml&#125;title'</span>)</span><br><span class="line"><span class="string">'Hello World'</span></span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>Unfortunately, there is no mechanism in the basic <strong>ElementTree</strong> parser to get further information about namespaces. However, you can get a bit more information about the scope of namespace processing if you’re willing to use the <strong>iterparse()</strong> function instead.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> xml.etree.ElementTree <span class="keyword">import</span> iterparse</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> evt, elem <span class="keyword">in</span> iterparse(<span class="string">'ns2.xml'</span>, (<span class="string">'end'</span>, <span class="string">'start-ns'</span>, <span class="string">'end-ns'</span>)):</span><br><span class="line"><span class="meta">... </span>print(evt, elem)</span><br><span class="line">...</span><br><span class="line">end &lt;Element <span class="string">'author'</span> at <span class="number">0x10110de10</span>&gt;</span><br><span class="line">start-ns (<span class="string">''</span>, <span class="string">'http://www.w3.org/1999/xhtml'</span>)</span><br><span class="line">end &lt;Element <span class="string">'&#123;http://www.w3.org/1999/xhtml&#125;title'</span> at <span class="number">0x1011131b0</span>&gt;</span><br><span class="line">end &lt;Element <span class="string">'&#123;http://www.w3.org/1999/xhtml&#125;head'</span> at <span class="number">0x1011130a8</span>&gt;</span><br><span class="line">end &lt;Element <span class="string">'&#123;http://www.w3.org/1999/xhtml&#125;h1'</span> at <span class="number">0x101113310</span>&gt;</span><br><span class="line">end &lt;Element <span class="string">'&#123;http://www.w3.org/1999/xhtml&#125;body'</span> at <span class="number">0x101113260</span>&gt;</span><br><span class="line">end &lt;Element <span class="string">'&#123;http://www.w3.org/1999/xhtml&#125;html'</span> at <span class="number">0x10110df70</span>&gt;</span><br><span class="line">end-ns <span class="keyword">None</span></span><br><span class="line">end &lt;Element <span class="string">'content'</span> at <span class="number">0x10110de68</span>&gt;</span><br><span class="line">end &lt;Element <span class="string">'top'</span> at <span class="number">0x10110dd60</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>elem <span class="comment"># This is the topmost element</span></span><br><span class="line">&lt;Element <span class="string">'top'</span> at <span class="number">0x10110dd60</span>&gt;</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<h2 id="Interacting-with-a-Relational-Database"><a href="#Interacting-with-a-Relational-Database" class="headerlink" title="Interacting with a Relational Database"></a>Interacting with a Relational Database</h2><p>You need to select, insert, or delete rows in a relational database. A standard way to represent rows of data in Python is as a sequence of tuples. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">stocks = [</span><br><span class="line"> (<span class="string">'GOOG'</span>, <span class="number">100</span>, <span class="number">490.1</span>),</span><br><span class="line"> (<span class="string">'AAPL'</span>, <span class="number">50</span>, <span class="number">545.75</span>),</span><br><span class="line"> (<span class="string">'FB'</span>, <span class="number">150</span>, <span class="number">7.45</span>),</span><br><span class="line"> (<span class="string">'HPQ'</span>, <span class="number">75</span>, <span class="number">33.2</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>The first step is to connect to the database. Typically, you execute a <strong>connect()</strong> function, supplying parameters such as the name of the database, hostname, username, password, and other details as needed.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> sqlite3</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>db= sqlite3.connect(<span class="string">'database.db'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c= db.cursor()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c.execute(<span class="string">'create table portfolio (symbol text, shares integer, price real)'</span>)</span><br><span class="line">&lt;sqlite3.Cursor object at <span class="number">0x054C97A0</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>db.commit()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>stocks = [</span><br><span class="line"><span class="meta">... </span> (<span class="string">'GOOG'</span>, <span class="number">100</span>, <span class="number">490.1</span>),</span><br><span class="line"><span class="meta">... </span> (<span class="string">'AAPL'</span>, <span class="number">50</span>, <span class="number">545.75</span>),</span><br><span class="line"><span class="meta">... </span> (<span class="string">'FB'</span>, <span class="number">150</span>, <span class="number">7.45</span>),</span><br><span class="line"><span class="meta">... </span> (<span class="string">'HPQ'</span>, <span class="number">75</span>, <span class="number">33.2</span>),</span><br><span class="line"><span class="meta">... </span>]</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c.executemany(<span class="string">'insert into portfolio values (?,?,?)'</span>, stocks)</span><br><span class="line">&lt;sqlite3.Cursor object at <span class="number">0x054C97A0</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>db.commit()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> row <span class="keyword">in</span> db.execute(<span class="string">'select * from portfolio'</span>):</span><br><span class="line"><span class="meta">... </span>    print(row)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line">(<span class="string">'GOOG'</span>, <span class="number">100</span>, <span class="number">490.1</span>)</span><br><span class="line">(<span class="string">'AAPL'</span>, <span class="number">50</span>, <span class="number">545.75</span>)</span><br><span class="line">(<span class="string">'FB'</span>, <span class="number">150</span>, <span class="number">7.45</span>)</span><br><span class="line">(<span class="string">'HPQ'</span>, <span class="number">75</span>, <span class="number">33.2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>min_price= <span class="number">100</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> row <span class="keyword">in</span> db.execute(<span class="string">'select * from portfolio where price &gt;= ?'</span>,(min_price,)):</span><br><span class="line"><span class="meta">... </span>    print(row)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line">(<span class="string">'GOOG'</span>, <span class="number">100</span>, <span class="number">490.1</span>)</span><br><span class="line">(<span class="string">'AAPL'</span>, <span class="number">50</span>, <span class="number">545.75</span>)</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/python/" rel="tag"><i class="fa fa-tag"></i> python</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/12/15/C05-Files-and-I-O/" rel="next" title="C05_Files_and_I/O">
                <i class="fa fa-chevron-left"></i> C05_Files_and_I/O
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/12/15/C07-Functions/" rel="prev" title="C07_Functions">
                C07_Functions <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.gif"
                alt="eustoma" />
            
              <p class="site-author-name" itemprop="name">eustoma</p>
              <p class="site-description motion-element" itemprop="description">Too young to be old, too old to be young</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">114</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">22</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/bobingski" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://t.me/naeJean" target="_blank" title="Telegram">
                      
                        <i class="fa fa-fw fa-telegram"></i></a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://newdoub.com" title="doubi1" target="_blank">doubi1</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://doub.io" title="doubi2" target="_blank">doubi2</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://google1.jiongjun.cc/" title="mirror" target="_blank">mirror</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://program-think.blogspot.com/" title="blogspot" target="_blank">blogspot</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Reading-and-Writing-CSV-Data"><span class="nav-number">1.</span> <span class="nav-text">Reading and Writing CSV Data</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Parsing-Simple-XML-Data"><span class="nav-number">2.</span> <span class="nav-text">Parsing Simple XML Data</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Parsing-Huge-XML-Files-Incrementally"><span class="nav-number">3.</span> <span class="nav-text">Parsing Huge XML Files Incrementally</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Turning-a-Dictionary-into-XML"><span class="nav-number">4.</span> <span class="nav-text">Turning a Dictionary into XML</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Parsing-Modifying-and-Rewriting-XML"><span class="nav-number">5.</span> <span class="nav-text">Parsing, Modifying, and Rewriting XML</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Parsing-XML-Documents-with-Namespaces"><span class="nav-number">6.</span> <span class="nav-text">Parsing XML Documents with Namespaces</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Interacting-with-a-Relational-Database"><span class="nav-number">7.</span> <span class="nav-text">Interacting with a Relational Database</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">eustoma</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
